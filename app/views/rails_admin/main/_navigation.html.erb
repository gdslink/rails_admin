<%
  accordion_navigation = RailsAdmin::Config::Sections::Navigation.accordion_navigation
%>

<div id="accordion">
  <%accordion_navigation[:sections].each do |section|%>
    <%
      section[:links].delete_if do |link|
        !link[:url_for] or !link[:url_for].include?(:model) or 
        (link[:url_for][:model] != nil && !authorized?(link[:url_for][:action], nil, link[:url_for][:model].constantize))
      end
    %>
    <%next if section[:links].length == 0%>    
    <h3>
      <%if section[:image] then%>
        <%=image_tag section[:image], {:class => "sectionImage"} %>
      <%end%>
      <%=link_to section[:label],  "#", {:id => "#{section[:label]}_id", :class => section[:match_keys]} %>
    </h3>
    <div>
      <p>
        <ul>
          <%section[:links].each do |link| %>
            <li>
              <%if link[:url_for] and link[:url_for].include?(:action) and link[:url_for].include?(:model)%>              
                <%if link[:image] then%>
                  <%=image_tag link[:image], {:class => "linkImage"} %>
                <%end%>
                <%=link_to link[:label], get_url(link[:url_for][:action], link[:url_for][:model]), :class => "sectionLink"%>
              <%end%>
            </li>
          <%end%>
        </ul>
      </p>
    </div>
  <%end%>
</div>
